<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Vignette 3 Preparing design objects | oSCR vignettes</title>
  <meta name="description" content="This bookdown is where we will collate oSCR vignettes." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Vignette 3 Preparing design objects | oSCR vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This bookdown is where we will collate oSCR vignettes." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Vignette 3 Preparing design objects | oSCR vignettes" />
  
  <meta name="twitter:description" content="This bookdown is where we will collate oSCR vignettes." />
  

<meta name="author" content="Chris Sutherland, Dan Linden &amp; Gates Dupont" />


<meta name="date" content="2020-07-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="criteria.html"/>
<link rel="next" href="design.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">oSCR: A Book Vignettes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Using this book</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#why-should-you-read-this-book"><i class="fa fa-check"></i><b>0.1</b> Why should you read this book?</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#why-should-you-use-oscr"><i class="fa fa-check"></i><b>0.2</b> Why should you use <code>oSCR</code></a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#getting-set-up"><i class="fa fa-check"></i><b>0.3</b> Getting set up</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="integrated-rsf-scr-models-in-oscr.html"><a href="integrated-rsf-scr-models-in-oscr.html"><i class="fa fa-check"></i><b>1</b> Integrated RSF-SCR models in <code>oSCR</code></a><ul>
<li class="chapter" data-level="1.1" data-path="integrated-rsf-scr-models-in-oscr.html"><a href="integrated-rsf-scr-models-in-oscr.html#simulating-capture-telemetry-data"><i class="fa fa-check"></i><b>1.1</b> Simulating capture &amp; telemetry data</a></li>
<li class="chapter" data-level="1.2" data-path="integrated-rsf-scr-models-in-oscr.html"><a href="integrated-rsf-scr-models-in-oscr.html#model-fitting-in-oscr"><i class="fa fa-check"></i><b>1.2</b> Model fitting in <code>oSCR</code></a></li>
<li class="chapter" data-level="1.3" data-path="integrated-rsf-scr-models-in-oscr.html"><a href="integrated-rsf-scr-models-in-oscr.html#application-to-ny-black-bears"><i class="fa fa-check"></i><b>1.3</b> Application to NY black bears</a></li>
<li class="chapter" data-level="1.4" data-path="integrated-rsf-scr-models-in-oscr.html"><a href="integrated-rsf-scr-models-in-oscr.html#summary"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="criteria.html"><a href="criteria.html"><i class="fa fa-check"></i><b>2</b> Design criteria</a></li>
<li class="chapter" data-level="3" data-path="objects.html"><a href="objects.html"><i class="fa fa-check"></i><b>3</b> Preparing design objects</a><ul>
<li class="chapter" data-level="3.1" data-path="objects.html"><a href="objects.html#background"><i class="fa fa-check"></i><b>3.1</b> Background</a></li>
<li class="chapter" data-level="3.2" data-path="objects.html"><a href="objects.html#creating-statespace-from-a-polygon"><i class="fa fa-check"></i><b>3.2</b> Creating <code>statespace</code> from a polygon</a><ul>
<li class="chapter" data-level="3.2.1" data-path="objects.html"><a href="objects.html#buffer-the-trappping-area"><i class="fa fa-check"></i><b>3.2.1</b> Buffer the trappping area</a></li>
<li class="chapter" data-level="3.2.2" data-path="objects.html"><a href="objects.html#generating-a-regular-grid"><i class="fa fa-check"></i><b>3.2.2</b> Generating a regular grid</a></li>
<li class="chapter" data-level="3.2.3" data-path="objects.html"><a href="objects.html#extracting-the-coordinates"><i class="fa fa-check"></i><b>3.2.3</b> Extracting the coordinates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="objects.html"><a href="objects.html#creating-alltraps-from-a-polygon"><i class="fa fa-check"></i><b>3.3</b> Creating <code>alltraps</code> from a polygon</a><ul>
<li class="chapter" data-level="3.3.1" data-path="objects.html"><a href="objects.html#create-all-technically-possible-points"><i class="fa fa-check"></i><b>3.3.1</b> Create all technically possible points</a></li>
<li class="chapter" data-level="3.3.2" data-path="objects.html"><a href="objects.html#create-all-practically-possible-points"><i class="fa fa-check"></i><b>3.3.2</b> Create all practically possible points</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="objects.html"><a href="objects.html#inspecting-the-objects"><i class="fa fa-check"></i><b>3.4</b> Inspecting the objects</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>4</b> Generating designs</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">oSCR vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="objects" class="section level1">
<h1><span class="header-section-number">Vignette 3</span> Preparing design objects</h1>
<p><em>Chris Sutherland &amp; Gates Dupont</em></p>
<div id="background" class="section level2">
<h2><span class="header-section-number">3.1</span> Background</h2>
<p>This document provides an example of generating the input objects for the optimal design function, <code>scrdesignGA()</code>, which is available in the spatial capture-recapture <code>R</code> package, <code>oSCR</code>. From the package help file (<code>?scrdesignGA()</code>):</p>
<blockquote>
<p><code>scrdesignGA()</code> implements a genetic algorithm to solve this k-of-n design problem. In the context of SCR, and for a given objective function and landscape, the function finds the best subset of sampling locations (k) from all possible sampling locations (n).</p>
</blockquote>
<p>We developed this framework with camera traps in mind, but this method can easily be applied to determine the general location of other non-invasive surveys, assuring that effort is standard across all sampling locations.</p>
<p>The functions requires the following input objects:</p>
<ul>
<li><p><code>statespace</code>: A discretized representation of the study area (state-space), defined as a convex hull around the trapping extent with an additional buffer of approximately <span class="math inline">\(3\times\sigma\)</span> to ensure the incorporation of the activity centers of all individuals available for captured.</p></li>
<li><p><code>alltraps</code>: A two-column dataframe, labelled <code>X</code> and <code>Y</code> accordingly, comprised of all possible trapping locations. These locations should be user-defined after accounting for logistic constraints, primarily accessibility. Design generation then relies on subsetting from these locations.</p></li>
</ul>
<p>The function also requires input values of <em>beta0</em> and <em>sigma</em> which will come from literature, pilot studies, or best guesses, and the number of traps which will be defined by the user. We do not discuss these inputs any further except to say that in this example we use values of <code>beta0</code> = 0.025, <code>sigma</code> =3.25, and <code>ntraps</code> = 50. Here the focus is on generating the <em>statespace</em> and <em>alltraps</em> objects.</p>
<p>Before getting started, a few packages should be loaded:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="objects.html#cb31-1"></a><span class="kw">library</span>(oSCR)      <span class="co"># Design-generating function</span></span>
<span id="cb31-2"><a href="objects.html#cb31-2"></a><span class="kw">library</span>(sf)        <span class="co"># Spatial data manipulation</span></span>
<span id="cb31-3"><a href="objects.html#cb31-3"></a><span class="kw">library</span>(raster)    <span class="co"># Raster data manipulation</span></span>
<span id="cb31-4"><a href="objects.html#cb31-4"></a><span class="kw">library</span>(ggplot2)   <span class="co"># Improved plotting</span></span>
<span id="cb31-5"><a href="objects.html#cb31-5"></a><span class="kw">library</span>(viridis)   <span class="co"># Color palette</span></span></code></pre></div>
</div>
<div id="creating-statespace-from-a-polygon" class="section level2">
<h2><span class="header-section-number">3.2</span> Creating <code>statespace</code> from a polygon</h2>
<p>Consider the motivating example in Dupont <em>et al.</em> (in review, <a href="https://www.biorxiv.org/content/10.1101/2020.04.16.045740v2">preprint on bioRxiv</a>), where the interest is designing an SCR study in an area defined by a watershed that can be represented as a polygon (<code>pak_poly</code>):</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="objects.html#cb32-1"></a><span class="co"># Plot the study area</span></span>
<span id="cb32-2"><a href="objects.html#cb32-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(pak_poly), <span class="dt">main =</span> <span class="ot">NULL</span>, <span class="dt">col =</span> <span class="st">&quot;grey90&quot;</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/showshape-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This polygon represents the general area within which traps can be deployed. The help file suggests that the statespace should be “a convex hull around the trapping extent with an additional buffer of approximately <span class="math inline">\(3\times\sigma\)</span>”. Creating the statespce object therefore requres first a buffering of the study area, then the creation of a regular grid of points withing that buffer.</p>
<div id="buffer-the-trappping-area" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Buffer the trappping area</h3>
<p>The first step is to buffer <code>pak_poly</code> using a buffer width of <span class="math inline">\(3\times\sigma\)</span>. In this case, <span class="math inline">\(\sigma\)</span> is 3.25, and three times that is 9.75. The projection of <code>pak_poly</code> is in UTM (i.e., meters), so we also need to make sure to convert <span class="math inline">\(\sigma\)</span>, which is in km, to m.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="objects.html#cb33-1"></a><span class="co"># Assign buffer distance</span></span>
<span id="cb33-2"><a href="objects.html#cb33-2"></a>buff &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">*</span>sigma<span class="op">*</span><span class="dv">1000</span>  <span class="co">#change to m</span></span>
<span id="cb33-3"><a href="objects.html#cb33-3"></a></span>
<span id="cb33-4"><a href="objects.html#cb33-4"></a><span class="co"># Create state-space from study area and buffer</span></span>
<span id="cb33-5"><a href="objects.html#cb33-5"></a>ss_polygon &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(pak_poly, <span class="dt">dist =</span> buff)</span>
<span id="cb33-6"><a href="objects.html#cb33-6"></a></span>
<span id="cb33-7"><a href="objects.html#cb33-7"></a><span class="co"># Plot the state-space and study area</span></span>
<span id="cb33-8"><a href="objects.html#cb33-8"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_polygon), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;grey90&quot;</span>)</span>
<span id="cb33-9"><a href="objects.html#cb33-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(pak_poly), <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/make_sspoly-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="generating-a-regular-grid" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Generating a regular grid</h3>
<p>The second step is to generate a regular grid of points within this area that represents the possible activity centers of all individuals that could be captured by any trap placed in <code>pak_poly</code>. This process is straightforward using the the spatial sampling function in the <code>sf</code> package (<code>sf::st_sample()</code>) and specifying <code>type = "regular"</code>. It does require that we approximate the number of points (the <code>size</code> argument), which requires that we also define the resolution (spacing) of this grid. We use a resolution equal to <span class="math inline">\(\sigma\)</span>, and therefore, the number of points is the area divided by the area of a pixel with sides equal to sigma:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="objects.html#cb34-1"></a><span class="co"># Assign the resolution of the state-space</span></span>
<span id="cb34-2"><a href="objects.html#cb34-2"></a>ssgrid_size &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">round</span>((<span class="kw">st_area</span>(ss_polygon)<span class="op">/</span><span class="dv">1000</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb34-3"><a href="objects.html#cb34-3"></a></span>
<span id="cb34-4"><a href="objects.html#cb34-4"></a><span class="co"># Sample points within the state-space at that resolution</span></span>
<span id="cb34-5"><a href="objects.html#cb34-5"></a>ss_points &lt;-<span class="st"> </span><span class="kw">st_sample</span>(<span class="dt">x =</span> ss_polygon, <span class="dt">size =</span> ssgrid_size, <span class="dt">type =</span> <span class="st">&quot;regular&quot;</span>)</span>
<span id="cb34-6"><a href="objects.html#cb34-6"></a></span>
<span id="cb34-7"><a href="objects.html#cb34-7"></a><span class="co"># Plot the state-space as pixels, the study area polygon, and the state-space polygon</span></span>
<span id="cb34-8"><a href="objects.html#cb34-8"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_points), <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.25</span>)</span>
<span id="cb34-9"><a href="objects.html#cb34-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(pak_poly), <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb34-10"><a href="objects.html#cb34-10"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_polygon), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/make_sspoints-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="extracting-the-coordinates" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Extracting the coordinates</h3>
<p>The <code>statespace</code> object should be a 2-column matrix or dataframe countaining the <code>X</code> and <code>Y</code> coordinates. These can be extrated directly from the spatial object <code>ss_points</code> using the <code>coordinates()</code> function. For convenience, here all coordinates are converted to the km scale (for UTM, divide by 1000).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="objects.html#cb35-1"></a><span class="co"># Generate state-space df from pixels</span></span>
<span id="cb35-2"><a href="objects.html#cb35-2"></a>statespace &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X =</span> <span class="kw">st_coordinates</span>(ss_points)[,<span class="dv">1</span>]<span class="op">/</span><span class="dv">1000</span>,</span>
<span id="cb35-3"><a href="objects.html#cb35-3"></a>                         <span class="dt">Y =</span> <span class="kw">st_coordinates</span>(ss_points)[,<span class="dv">2</span>]<span class="op">/</span><span class="dv">1000</span>)</span></code></pre></div>
</div>
</div>
<div id="creating-alltraps-from-a-polygon" class="section level2">
<h2><span class="header-section-number">3.3</span> Creating <code>alltraps</code> from a polygon</h2>
<div id="create-all-technically-possible-points" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Create all technically possible points</h3>
<p>Using the same principles and functions as the previous section, the first step for creating the <code>alltraps</code> object is to generate a regular grid of points within this area that represents all possible trapping locations. We use <span class="math inline">\(0.5\times\sigma\)</span> here, but as long as the spacing is not larger than <code>sigma</code> the end result should not be effected<span class="math inline">\(^{\dagger}\)</span>. Again, this process is straightforward using the the spatial sampling function in the <code>sf</code> package (<code>sf::st_sample()</code>) and specifying <code>type = "regular"</code>.</p>
<p><span class="math inline">\(^\dagger\)</span> this has not been formally evaluated, but should be easy to test.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="objects.html#cb36-1"></a><span class="co"># Determine possible trap spacing</span></span>
<span id="cb36-2"><a href="objects.html#cb36-2"></a>traps_size &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">as.numeric</span>((<span class="kw">st_area</span>(pak_poly)<span class="op">/</span><span class="dv">1000</span><span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="co">#m -&gt; km </span></span>
<span id="cb36-3"><a href="objects.html#cb36-3"></a><span class="st">                         </span>(<span class="fl">0.5</span><span class="op">*</span>sigma)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb36-4"><a href="objects.html#cb36-4"></a></span>
<span id="cb36-5"><a href="objects.html#cb36-5"></a><span class="co"># Generate traps using that spacing</span></span>
<span id="cb36-6"><a href="objects.html#cb36-6"></a>alltraps &lt;-<span class="st"> </span><span class="kw">st_sample</span>(<span class="dt">x =</span> pak_poly, <span class="dt">size =</span> traps_size, <span class="dt">type =</span> <span class="st">&quot;regular&quot;</span>)</span>
<span id="cb36-7"><a href="objects.html#cb36-7"></a></span>
<span id="cb36-8"><a href="objects.html#cb36-8"></a><span class="co"># Plot the state-space, study area, and possible trap locations</span></span>
<span id="cb36-9"><a href="objects.html#cb36-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_polygon), <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb36-10"><a href="objects.html#cb36-10"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(pak_poly), <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb36-11"><a href="objects.html#cb36-11"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(alltraps), <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.25</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/make_alltraps-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="create-all-practically-possible-points" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Create all practically possible points</h3>
<p>Part of the motivation for developing this design generation framework was to accomodate sampling restrictions and logistical constraints in the design phase (as opposed to adjusting <em>in situ</em>). To demonstrate this in practice, sampling in these mountainous areas of the snow leopard range in Pakistan has two obvious challenges:</p>
<ol style="list-style-type: decimal">
<li>areas too steep cannot be sampled (we use a slope cut-off of 45<span class="math inline">\(^\circ\)</span>)</li>
<li>areas too high (in elevation) cannot be sampled (we use an elevation cut-off of 4500<span class="math inline">\(m\)</span>)</li>
</ol>
<p>Luckily, elevation layers are available so we can use that (<code>elev</code>), and slope can be derived using the <code>terrain()</code> function from the <code>raster</code> package.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="objects.html#cb37-1"></a><span class="co">#the layer &#39;elev&#39; has been loaded</span></span>
<span id="cb37-2"><a href="objects.html#cb37-2"></a></span>
<span id="cb37-3"><a href="objects.html#cb37-3"></a><span class="co"># Generate the slope raster from the elevation raster</span></span>
<span id="cb37-4"><a href="objects.html#cb37-4"></a>slop &lt;-<span class="st"> </span><span class="kw">terrain</span>(elev, <span class="dt">opt =</span> <span class="st">&#39;slope&#39;</span>, <span class="dt">unit =</span> <span class="st">&#39;degrees&#39;</span>, <span class="dt">neighbors =</span> <span class="dv">8</span>)</span>
<span id="cb37-5"><a href="objects.html#cb37-5"></a></span>
<span id="cb37-6"><a href="objects.html#cb37-6"></a><span class="co"># Plot the elevation and slope side-by-side</span></span>
<span id="cb37-7"><a href="objects.html#cb37-7"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">new =</span> <span class="ot">FALSE</span>)</span>
<span id="cb37-8"><a href="objects.html#cb37-8"></a><span class="kw">plot</span>(elev, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="kw">viridis</span>(<span class="dv">100</span>, <span class="dt">option =</span> <span class="st">&quot;D&quot;</span>)) </span>
<span id="cb37-9"><a href="objects.html#cb37-9"></a><span class="kw">plot</span>(slop, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="kw">viridis</span>(<span class="dv">100</span>, <span class="dt">option =</span> <span class="st">&quot;E&quot;</span>))</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/show_rasters-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Using the <code>extract()</code> function from the <code>raster</code> package, we can extract the elevation and slope values for each potential trap location. Then, using the cut-off values, we can identify and select only those points that are ‘sampleable’. As with the <code>statespce</code> object, the <code>alltraps</code> object should be 2-column matrix or dataframe countaining the <code>X</code> and <code>Y</code> coordinates of the sample points.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="objects.html#cb38-1"></a><span class="co"># Possible trap locations to 2-column object (dataframe or matrix)</span></span>
<span id="cb38-2"><a href="objects.html#cb38-2"></a>allpoints &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(alltraps)</span>
<span id="cb38-3"><a href="objects.html#cb38-3"></a></span>
<span id="cb38-4"><a href="objects.html#cb38-4"></a><span class="co"># Extract elevation and slope for the traps</span></span>
<span id="cb38-5"><a href="objects.html#cb38-5"></a>allpoints_elev &lt;-<span class="st"> </span><span class="kw">extract</span>(elev, allpoints)</span>
<span id="cb38-6"><a href="objects.html#cb38-6"></a>allpoints_slop &lt;-<span class="st"> </span><span class="kw">extract</span>(slop, allpoints)</span>
<span id="cb38-7"><a href="objects.html#cb38-7"></a></span>
<span id="cb38-8"><a href="objects.html#cb38-8"></a><span class="co"># Subset possible trap locations according to logistic constraints</span></span>
<span id="cb38-9"><a href="objects.html#cb38-9"></a>alltraps &lt;-<span class="st"> </span>allpoints[allpoints_elev <span class="op">&lt;</span><span class="st"> </span><span class="dv">4500</span>  <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb38-10"><a href="objects.html#cb38-10"></a><span class="st">                      </span>allpoints_slop <span class="op">&lt;</span><span class="st"> </span><span class="dv">45</span>    <span class="op">&amp;</span></span>
<span id="cb38-11"><a href="objects.html#cb38-11"></a><span class="st">                      </span><span class="op">!</span><span class="kw">is.na</span>(allpoints_elev) <span class="op">&amp;</span></span>
<span id="cb38-12"><a href="objects.html#cb38-12"></a><span class="st">                      </span><span class="op">!</span><span class="kw">is.na</span>(allpoints_slop) ,]<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb38-13"><a href="objects.html#cb38-13"></a></span>
<span id="cb38-14"><a href="objects.html#cb38-14"></a><span class="co"># Plot all of the traps below the now subsetted (usable) traps (now called &quot;alltraps&quot;)</span></span>
<span id="cb38-15"><a href="objects.html#cb38-15"></a><span class="kw">plot</span>(allpoints<span class="op">/</span><span class="dv">1000</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, </span>
<span id="cb38-16"><a href="objects.html#cb38-16"></a>     <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">axes  =</span><span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb38-17"><a href="objects.html#cb38-17"></a><span class="kw">points</span>(alltraps, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/extract-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The removal of points can also be done using a polygon that delineated unsampleable areas (e.g., cities or areas that are impossible to access). In the following example, we remove potential trapping points using a polygon called <code>nogo_areas</code> that represent inaccessible parts of the landscape.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="objects.html#cb39-1"></a><span class="co">#the shapefile &#39;nogo_areas&#39; has been loaded</span></span>
<span id="cb39-2"><a href="objects.html#cb39-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_polygon), <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb39-3"><a href="objects.html#cb39-3"></a><span class="kw">points</span>(alltraps<span class="op">*</span><span class="dv">1000</span>, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.2</span>, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)</span>
<span id="cb39-4"><a href="objects.html#cb39-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(nogo_areas), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/show_nogo-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Its <em>much</em> easier to use spatial objects to identify and remove overlapping regions:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="objects.html#cb40-1"></a>alltraps_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X=</span>alltraps[,<span class="st">&quot;X&quot;</span>]<span class="op">*</span><span class="dv">1000</span>,</span>
<span id="cb40-2"><a href="objects.html#cb40-2"></a>                          <span class="dt">Y=</span>alltraps[,<span class="st">&quot;Y&quot;</span>]<span class="op">*</span><span class="dv">1000</span>)</span>
<span id="cb40-3"><a href="objects.html#cb40-3"></a>alltraps_sp &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(alltraps_df,<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&quot;X&quot;</span>,<span class="st">&quot;Y&quot;</span>))</span>
<span id="cb40-4"><a href="objects.html#cb40-4"></a><span class="kw">st_crs</span>(alltraps_sp) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(nogo_areas)</span>
<span id="cb40-5"><a href="objects.html#cb40-5"></a></span>
<span id="cb40-6"><a href="objects.html#cb40-6"></a><span class="co">#subset the spatial object</span></span>
<span id="cb40-7"><a href="objects.html#cb40-7"></a>alltraps_sp<span class="op">$</span>nogo &lt;-<span class="st"> </span><span class="kw">lengths</span>(<span class="kw">st_within</span>(alltraps_sp, nogo_areas))</span>
<span id="cb40-8"><a href="objects.html#cb40-8"></a>cliptraps_sp &lt;-<span class="st"> </span>alltraps_sp[alltraps_sp<span class="op">$</span>nogo <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,]</span>
<span id="cb40-9"><a href="objects.html#cb40-9"></a></span>
<span id="cb40-10"><a href="objects.html#cb40-10"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ss_polygon), <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb40-11"><a href="objects.html#cb40-11"></a><span class="kw">plot</span>(alltraps_sp, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.1</span>, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb40-12"><a href="objects.html#cb40-12"></a><span class="kw">plot</span>(cliptraps_sp, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.3</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb40-13"><a href="objects.html#cb40-13"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(nogo_areas), <span class="dt">lwd=</span><span class="dv">1</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/clip_nogo-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="objects.html#cb41-1"></a>alltraps &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(cliptraps_sp)<span class="op">/</span><span class="dv">1000</span></span></code></pre></div>
</div>
</div>
<div id="inspecting-the-objects" class="section level2">
<h2><span class="header-section-number">3.4</span> Inspecting the objects</h2>
<p>With both objects created (<code>statespace</code> and <code>alltraps</code>), it is worth plotiing the objects to confirm that they all line up in space.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="objects.html#cb42-1"></a><span class="co"># Plot the generated objects</span></span>
<span id="cb42-2"><a href="objects.html#cb42-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb42-3"><a href="objects.html#cb42-3"></a><span class="kw">plot</span>(statespace, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="dv">1</span>,    <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb42-4"><a href="objects.html#cb42-4"></a><span class="kw">plot</span>(alltraps,   <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb42-5"><a href="objects.html#cb42-5"></a><span class="kw">plot</span>(statespace, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="dv">1</span>,    <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb42-6"><a href="objects.html#cb42-6"></a><span class="kw">points</span>(alltraps, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>,  <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="oSCRvignettes_files/figure-html/plotcheck-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Great! Both objects are created and spatially aligned, and the units appear to be on the km scale. These are the landscape (<code>statespace</code>) and trap (<code>alltraps</code>) inputs for <code>scrdesignGA()</code>.</p>
<p>As previously mentioned: if you have any issues or questions, we have a very responsive, and friendly <a href="https://groups.google.com/forum/#!forum/oscr_package">user group</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="criteria.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="design.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["oSCRvignettes.pdf", "oSCRvignettes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
